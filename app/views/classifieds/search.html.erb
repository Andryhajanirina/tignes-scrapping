<head>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
  

</head>

<body>
  <h1>Prices search</h1>
  <p>Find the average price </p>

    <%=form_tag({controller: "classifieds", action: "search"}, method: :get) do %>
      <%= label_tag(:ville, "Station de ski") %>
      <%= select_tag(:ville, options_for_select(Classified.group("ville").pluck("ville"))) %>
      <%= label_tag(:number_of_guests, "Nombre de place dans l'appartement") %>
      <%= select_tag(:number_of_guests, options_for_select((1..12).to_a))%>
      <%= submit_tag 'trouvez les prix moyen', class: "btn btn-primary" %>
    <% end %>

  <% unless @results.nil? || @results.size == 0 %>

  <p>Prix moyen par semaine : <%= (@average_price * 7).round %></tr></p>
    <table style="width:100%">
      <tr>
        <th>Station de ski</th>
        <th>Semaine débutant le :</th>
        <th>Prix par semaine</th>
        <th>Intitulé de l'annonce</th>
      </tr>

      <tbody>
        <% @results.each do |r| %>
        <tr>
          <td><%=r['ville'].capitalize %></td>
          <td><%="#{r['start_date'].mday}-#{r['start_date'].mon}-#{r['start_date'].year}"%></td>
          <td><%=(r['price']*7).round %></td>
          <td><%=r['title'] %></td>
        </tr>
        <% end %>
        
      </tbody>

    </table> 
  <% end %>
</body>